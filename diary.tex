%%
%% This is file `diary.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% diary.dtx  (with options: `diarydriver')
%% 
%% Copyright (C) 2010 by Tin Lok Wong
%% 
%% This code is written by me (Tin Lok Wong).
%% The files may be distributed freely,
%%  but do not change its contents unless you change its name too.
%% If you modify my code, then please attribute appropriately.
%% The code is not written for money.
%% 
%% 
\documentclass[a4paper,twoside]{book}

\setlength{\textwidth}{\paperwidth}
\addtolength{\textwidth}{-2cm}
\addtolength{\textwidth}{-2.5cm}
\setlength{\oddsidemargin}{2cm}
\addtolength{\oddsidemargin}{-1in}
\setlength{\evensidemargin}{2.5cm}
\addtolength{\evensidemargin}{-1in}
\setlength{\textheight}{\paperheight}
\addtolength{\textheight}{-3cm}
\addtolength{\textheight}{-3cm}
\setlength{\topmargin}{-1in}
\addtolength{\topmargin}{3cm}
\addtolength{\topmargin}{-\headheight}
\addtolength{\topmargin}{-\headsep}

%% Load any extra packages you need for the diary here.


%% All internal commands are
%%  between the "\makeatletter ... \makeatother" pair.
\makeatletter%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcount\di@tempcnta
\newcount\di@tempcntb
\newcount\di@tempcntc
\newcommand{\di@temptext}{\relax}

\newcounter{currentday}
\renewcommand{\thecurrentday}{\arabic{currentday}}
\setcounter{currentday}{0}
\newcounter{currentmonth}
\renewcommand{\thecurrentmonth}{\arabic{currentmonth}}
\setcounter{currentmonth}{0}
\newcounter{currentyear}
\renewcommand{\thecurrentyear}{\arabic{currentyear}}
\setcounter{currentyear}{0}

\newcommand{\di@montherrmes}{No such month}

\newcommand{\numtomonth}[1]{%
 \ifcase#1\di@montherrmes\or January\or February\or March\or
  April\or May\or June\or July\or August\or September\or
  October\or November\or December\else\di@montherrmes\fi%
}
\newcommand{\numtomonthabbrv}[1]{%
 \ifcase#1\di@montherrmes\or jan\or feb\or mar\or apr\or may\or
  jun\or jul\or aug\or sep\or oct\or nov\or
  dec\else\di@montherrmes\fi%
}
\newcommand{\numdaysin}[1]{%
 \ifcase#1\relax0\or31\or29\or31\or30\or31\or30\or31\or31\or30\or
  31\or30\or31\else0\fi%
}
\newcommand{\ordinal}[1]{%
 \di@tempcntc=#1\relax%
 #1%
 \ifnum\di@tempcntc=1\textsuperscript{st}%
  \else\ifnum\di@tempcntc=21\textsuperscript{st}%
   \else\ifnum\di@tempcntc=31\textsuperscript{st}%
    \else\ifnum\di@tempcntc=2\textsuperscript{nd}%
     \else\ifnum\di@tempcntc=22\textsuperscript{nd}%
      \else\ifnum\di@tempcntc=3\textsuperscript{rd}%
       \else\ifnum\di@tempcntc=23\textsuperscript{rd}%
        \else\textsuperscript{th}%
        \fi%
       \fi%
      \fi%
     \fi%
    \fi%
   \fi%
  \fi%
}

\newcommand{\inputday}[2]{%
 \setcounter{currentmonth}{#1}%
 \setcounter{currentday}{#2}%
 \section*{\ordinal{#2}~\numtomonth{#1}\di@showfest{#1}{#2}}
 \markboth{\scshape The Diaries of \@author}%
          {\scshape\ordinal{#2}~\numtomonth{#1}}%
 \addcontentsline{toc}{section}{\ordinal{#2}~\numtomonth{#1}}%
 \input{\numtomonthabbrv{#1}/#2}%
 \penalty0%
}
\newcommand{\includemonth}[1]{%
 \setcounter{currentmonth}{#1}%
 \include{\numtomonthabbrv{#1}/main}%
}
\newcommand{\inputdaysin}[1]{%
 \setcounter{currentmonth}{#1}%
 \chapter*{\numtomonth{#1}}
 \addcontentsline{toc}{chapter}{\numtomonth{#1}}%
 \di@tempcnta=0%
 \loop%
  \advance\di@tempcnta by 1%
  \inputday{\thecurrentmonth}{\the\di@tempcnta}%
  \ifnum\di@tempcnta<\numdaysin{\thecurrentmonth}%
 \repeat%
}
\newcommand{\makewholediary}{%
 \di@tempcntb=0%
 \loop%
  \advance\di@tempcntb by 1%
  {\includemonth{\the\di@tempcntb}}%
  \ifnum\di@tempcntb<12%
 \repeat%
}

\newcommand{\inyear}[2]{%
 \subsection*{#1~\dotfill~#2}%
}
\newcommand{\daycomment}[1]{%
 \begin{flushright}\em#1\end{flushright}%
}
\newcommand{\festival}[1]{%
 \di@makefest{\numtomonthabbrv{\thecurrentmonth}}%
             {\roman{currentday}}{#1}%
}
\newcommand{\di@makefest}[3]{%
 \immediate\write\@auxout%
  {\string\gdef\string\di@#1#2{#3}}%
}
\newcommand{\di@showfest}[2]{%
 \expandafter\let\expandafter\di@temptext%
   \csname di@\numtomonthabbrv{#1}\romannumeral#2\endcsname
 \ifx\di@temptext\relax\else\space---\space\di@temptext\fi%
}
\newcommand{\separate}{%
 \begin{center}\raisebox{.5ex}{\rule{.5\textwidth}{.2pt}}\end{center}%
}
\renewcommand{\maketitle}{%
 \begin{titlepage}%
  \null\vfill%
  \begin{center}%
   {\large\scshape THE\par}\vskip 3em%
   {\@setfontsize\huge\@xxvpt{30}\bfseries
    D\,I\,A\,R\,I\,E\,S\par}\vskip 3em%
   {\large\scshape OF\par}\vskip 3em%
   {\huge\scshape\@author}%
  \end{center}%
  \vfill%
  \begin{center}\large
   \rule{.5\textwidth}{.2pt}\vskip 1em%
   Private and confidential\vskip 1em%
   \number\year
  \end{center}%
 \end{titlepage}%
}
\makeatother%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Any typographical commands go in here.


%% Any personal commands go in here.


\author{Diary Man}

%% \pagestyle{myheadings}
\pagestyle{plain}

\newcommand{\filesin}[1]{%
 \numtomonthabbrv{#1}/main%
}
\includeonly{\filesin{5},\filesin{8},\filesin{9}}

\setcounter{tocdepth}{0}

\begin{document}
\maketitle
%% \tableofcontents
\makewholediary
\end{document}
